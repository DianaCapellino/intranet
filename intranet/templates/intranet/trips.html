{% extends "intranet/layout.html" %}

{% block body %}
<div id="new_trip" class="d-none">
    <h2>Crear Nuevo Viaje</h2>

    {% if message %}
        <div class="message text-center">{{ message }}</div>
    {% endif %}

    <br>
    <br>
    <div class="container">
        <div class="text-center">
            <form class="rw-3 text-center" action="{% url 'trips' %}" method="post">
                {% csrf_token %}
                <div class="form">
                    <div class="row">
                        <div class="mb-3 col">
                            <input autofocus class="form-control" type="text" name="name" id="name" placeholder="Nombre">
                        </div>
                    </div>
                    <div class="row">
                        <div class="mb-3 col">
                            <label for="starting_date">Fecha Pedido</label>
                            <input class="form-control date-input" type="date" name="starting_date" id="starting_date" value="today();" data-mdb-inline="true" placeholder="Fecha Ingreso">
                        </div>
                        <div class="mb-3 col">
                            <label for="travelling_date">Fecha Viaje</label>
                            <input class="form-control date-input" type="date" name="travelling_date" id="travelling_date" value="today();" data-mdb-inline="true" placeholder="Fecha Ingreso">
                        </div>
                    </div>
                    <div class="row">
                        <div class="mb-3 col">
                            <select class="form-select" aria-label="client" name="client">
                                <option selected>Cliente</option>
                                {% for client in clients %}
                                <option value="{{ client.id }}">{{ client.name }}</option>
                                {% endfor %}
                            </select>
                        </div>                    
                        <div class="mb-3 col">
                            <select class="form-select" aria-label="contact" name="contact">
                                <option selected>Contacto</option>
                                {% for contact in contacts %}
                                <option value="{{ contact.id }}">{{ contact.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="mb-3 col">
                            <input autofocus class="form-control" type="text" name="client_reference" id="client_reference" placeholder="Referencia Cliente">
                        </div>
                        <div class="mb-3 col">
                            <select class="form-select" aria-label="status" name="status">
                                <option selected>Status</option>
                                {% for option in status %}
                                <option value="{{ option.0 }}">{{ option.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <input class="btn btn-dark" type="submit" value="GUARDAR">
                </div>
            </form>
        </div>
    </div>
</div>
<div id="new_trip_container" class="container text-center">
    <button id="new_trip_btn" class="btn btn-dark btn-lg">NUEVO VIAJE</button>
</div>
<div id="trip_list">
    <div class="container">
        <br>
        <h2>Viajes</h2>
    
        {% if message %}
            <div>{{ message }}</div>
        {% endif %}
    
        <br>
        <div class="row">
            <div class="col-12">
                <div style="width:100%">
                    <table id="trips" class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Status</th>
                                <th>Version</th>
                                <th>Monto</th>
                                <th>Cliente</th>
                                <th>Ref Cliente</th>
                                <th>Contacto</th>
                                <th>Fecha Viaje</th>
                                <th>Acciones</th>
                            </tr>
                            <tbody>
                                {% for trip in trips %}
                                <tr data-bs-toggle="modal" data-bs-target="#windowTrip{{ trip.id }}">
                                    <td>{{ trip.name }}</td>
                                    <td>{{ trip.status }}</td>
                                    {% if trip.version == none %}
                                        <td>n/a</td>
                                    {% else %}
                                        <td>{{ trip.version }}</td>
                                    {% endif %}
                                    {% if trip.amount == none %}
                                        <td>n/a</td>
                                    {% else %}
                                        <td>{{ trip.amount }}</td>
                                    {% endif %}
                                    <td>{{ trip.client }}</td>
                                    {% if trip.client_reference == none %}
                                        <td>n/a</td>
                                    {% else %}
                                        <td>{{ trip.client_reference }}</td>
                                    {% endif %}
                                    <td>{{ trip.contact }}</td>
                                    <td>{{ trip.travelling_date }}</td>
                                    <td>
                                        <div class="justify-content-around d-flex">
                                            <i class="fa-solid fa-pencil" id="pencil-trip-{{trip.id}}" aria-hidden="true"></i>
                                            <i class="fa-solid fa-trash" id="trash-trip-{{trip.id}}" aria-hidden="true"></i>
                                        </div>
                                    </td>
                                </tr>
                                <div class="modal fade modal-xl modal-trip" id="windowTrip{{ trip.id }}" tabindex="-1" aria-labelledby="label{{ trip.id }}">
                                    <div class="modal-dialog modal-dialog-scrollable">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-8" id="label{{ trip.id }}">{{ trip.name }} - {{ trip.client }}</h1>
                                                <button tyle="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div id="new_entry_container" class="container text-center">
                                                    <a href="{% url 'create_entry' trip.id %}" ><button id="new_entry_btn{{ trip.id }}" class="btn btn-dark btn-lg">NUEVA ENTRADA</button></a>
                                                </div>
                                                <h3>Entradas</h3>
                                                <div id="entries-{{ trip.id }}"></div>
                                                <br>
                                                <h3>Notas</h3>
                                                <div id="notes-{{ trip.id }}"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </tbody>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
{% endblock %}